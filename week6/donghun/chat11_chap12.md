# 11장 뉴스 피드 시스템

뉴스 피드 : 홈 페이지 중앙에 지속적으로 업데이트되는 스토리

- 문제 이해 및 설계 범위 확정
    - 웹, 앱 지원 여부
    - 중요한 기능
    - 스토리 배치 순서
    - 한명의 사용자가 가질 수 있는 친구
    - 트래픽 규모
    - 이미지나 동영상 업로드 지원 여부
- 개략적 설계안 제시 및 동의 구하기
    - 피드 발행

      뉴스 피드 api

    - 피드 생성
- fan out 서비스
    - push 모델
        - 쓰기 시점 갱신
    - pull 모델
        - 읽기 시점 갱신
- 캐시 구조

    - 뉴스 피드: 뉴스 피드의 ID를 보관한다.
    - 콘텐츠: 포스팅 데이터를 보관한다 인기 콘텐츠는 따로 보관한다.
    - 소셜그래프: 사용자 간 관계 정보를 보관한다.
    - 행동(action): 포스팅에 대한 사용자의 행위에 관한 정보를 보관한다. 포스
      팅에 대한 '좋아요', 답글 둥둥이 이에 해당한다.
    - 횟수(counter):'좋아요' 횟수, 응답 수, 팔로어 수, 팔로잉 수 등의 정보를 보
      관한다
# 12장 채팅 시스템 설계

일대일 채팅앱인지 그룹 채팅앱인지 먼저 명확하게 정의

모바일 앱인지 웹 앱인지

- 모바일 웹 (Mobile Web)

  모바일 브라우저(Safari, Chrome 등)를 통해 접속하는 일반 웹사이트

- 웹앱

  웹 기술로 만들어졌지만 앱처럼 동작하는 애플리케이션 ex. pwa


처리해야 하는 트래픽 규모

그룹채팅의 경우 인원 제한

중요 기능(첨부 파일 지원 같은) 지원 여부

메시지 길이 제한

종단 간 암호화 지원 여부

채팅 이력 보관 기간

클라이언트와 채팅 서비스 사이의 관계


메시지 송신 클라이언트는 수신 클라이언트에게 전달할 메시지를 채팅 서비스로 보낼때 HTTP 프로토콜을 사용한다. 이때 채팅 서비스와의 접속에는 keep-alive 헤더를 사용하면 효율적인데, 이는 연결을 계속 유지해서 TCP 접속 과정에서 발생하는 핸드셰이크 횟수를 줄일 수 있기 때문이다.

다만, 서버가 클라이언트에게 보내는 것은 쉽지 않으므로 이를 위해 폴링, 롤 폴링, 웹소켓 기술이 도입되었다.

- 폴링

  클라이언트가 주기적으로 서버에게 새 메시지가 있느냐고 물어보는 방법

  폴링 비용은 폴링을 자주할수록 올라간다. 왜냐하면 답해줄 메시지가 없을 경우가 많고 이는 서버 자원의 낭비이기 때문이다.


- 롱 폴링

  롱 폴링은 좀 더 효율적인데 클라이언트에게 새 메시지가 반환되거나 타임아웃 될떄까지 연결을 유지한다. 클라이언트는 새 메시지를 받으면 기존 연결을 종료하고 서버에 새로운 요청을 보내어 모든 절차를 다시 시작한다.


  다만 이 경우 몇가지 문제가 있는데

    - 메시지를 보내는 클라이언트와 수신하는 클라이언트가 다른 채팅 서버에 있을 수 있는데 특히 http 서버들을 stateless하므로 메시지를 받은 서버가 해당 메시지를 수신할 클라이언트와의 롤 폴링 연결을 가지고 있지 않을 수 있다는 것
    - 서버 입장에서 클라이언트가 연결을 해제했는지 아닌지 알 방법이 없다는 것
    - 여전히 비효율적으로 메시지를 많이 받지 않는 클라이언트도 타임아웃이 일어날 때마다 주기적으로 서버에 다시 접속할 것이므로

- 웹소켓

  서버가 클라이언트에게 비동기 메시지를 보낼때 가장 널리 사용하는 기술이다.