# 9장 웹 크롤러

웹 크롤러는 로봇 또는 스파이더라고 부른다.

검색 엔진에서 널리 쓰는 기술로, 웹에 새로 올라오거나 갱신된 콘텐츠를 찾아내는 것이
주된 목적이다.

그중에서도 대표적인 사용처는

1. 검색 엔진 인덱싱
    1. 웹 페이지를 모아 검색 엔진을 위한 로컬 인덱스를 만든다
2. 웹 아카이빙
    1. 장기보관하기 위해 웹에서 정보를 모으는 절차
3. 웹 마이닝
    1. 데이터를 수집해서 유용한 지식을 도출
4. 웹 모니터링
    1. 저작권, 상표권이 침해되는 사례 모니터링

웹 크롤러의 복잡도는 웹 크롤러가 처리해야 하는 데이터의 규모에 따라 달라진다.

웹 크롤러의 기본 알고리즘

1. URL 집합이 입력으로 주어지면, 해당 URL들이 가리키는 모든 웹 페이지를
   다운로드한다.
2. 다운받은 웹 페이지에서 URL들을 추출한다.
3. 추출된 URL들을 다운로드할 URL 목록에 추가하고 위의 과정을 처음부터
   반복한다

좋은 크롤러가 만족시켜야 할 속성

1. 규모 확장성 : 웹은 거대하므로 병행성을 활용하면 보다 효과적으로 크롤링을 할 수 있을 것이다
2. 안정성 : 웹은 함정으로 가득하다. 크롤러는 비정상적 입력이나 환경에 잘 대응할 수 있어야 한다
3. 예절 : 수집 대상 웹 사이트에 짧은 시간 동안 너무 많은 요청을 보내서는 안 된다.
4. 확장성 : 새로운 형태의 콘텐츠를 지원하기 쉬워야 한다.

웹 크롤러 설계안


크롤러가 가능한 한 많은 링크를 탐색할 수 있도록 하는 URL을 골라야 하므로

전체 URL 공간을 작은 부분집합으로 나누는 전략을 쓴다

- 미수집 URL 저장소
    - 대부분의 현대적 웹 크롤러는 크롤링 상태를 (1) 다운로드할 URL, 그리고 2)다운로드된 URL의 두 가지로 나눠 관리한다. 이 중 '다운로드할 URL'을 저장 관리하는 컴포넌트를 미수집 URL 저장소(URL frontier)라고 부른다
- HTML 다운로더
    - 인터넷에서 웹 페이지를 다운로드하는 컴포넌트, url은 미수집 url 저장소가 제공
- 도메인 이름 변환기
    - URL에 대응되는 IP 주소를 알아내는 역할
- 콘텐츠 파서
    - 이상한 웹 페이지 판별
- 중복 콘텐츠
    - 자료 구조를 도입하여 데이터 중복을 줄이고 데이터 처리에 소요되는 시간 단축
- 콘텐츠 저장소
    - html 문서를 보관하는 시스템
    - 저장소 구현에 쓰일 기술은 저장할 데이터의 유형,크기, 접근 빈도, 데이터 유효기간등을 기반으로 판단
- URL 추출기
    - html 문서를 파싱하여 링크들을 골라내는 역할 , 상대경로들을 절대경로로 변환
- URL 필터
    - 특정한 콘텐츠 타입이나 파일 확장자를 갖는 URL, 오류나 접근이 금지된 URL을 크롤링 대상에서 배제하는 역할
- 이미 방문한 URL
    - 블룸 필터나 해시 테이블을 이용해서 기존에 방문했던 URL인지 확인
- URL 저장소
    - 이미 방문한 URL을 보관하는 저장소

## 구현

- DFS VS BFS
    - 웹 크롤러는 보통 BFS를 사용
- 미수집 URL 저장소

- 신선도
    - 재수집을 주기적으로 해야 함
    - 이때 웹 페이지의 변경 이력, 우선순위를 활용
- html 다운로더
    - robots.txt
        - 로봇 제외 프로토콜
        - 크롤러가 수집해도 되는 페이지 목록
    - 성능 최적화
        - 분산 크롤링
            - 성능을 높이기 위해 크롤링 작업을 여러 서버에 분산

        - 도메인 이름 변환 결과 캐시
            - 동기적으로 처리되는 dns 요청을 캐싱해서 성능을 향상
        - 지역성
            - 서버를 지역별로 분산
            - 가까울수록 다운로드 시간은 감소
        - 짧은 타임아웃
            - 응답하지 않거나 느린 웹서버가 있을때 얼마나 기다릴지 미리 정해놓기
        -

# 10장 알림 시스템

알림 시스템은 모바일 푸시 알림, sms 메시지, 이메일 3가지로 분류할 수 있다

- ios 푸시 알림
    - 알림 제공자
    - apns
    - ios 단말
- 안드로이드
    - fcm
- sms
    - 트윌리오, 넥스모 같은 3자 서비스
- 이메일
    - 센드그리드, 메일침프

- 알림 시스템 설계시 고려사항
    - 안정성
        - 데이터 손실 방지를 위해 재시도 매커니즘 구현
        - 알림 중복 전송 방지를 위해 중복 탐색 메커니즘 도입
    - 템플릿
    - 전송률 제한
    - 재시도
    - 큐 모니터링
    - 이벤트 추적